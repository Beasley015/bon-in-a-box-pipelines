script: getAreaOfHabitat.R
name: Get area of habitat
description: >
  This script loads the range map of the chosen species, crops it to the study area limits and filters the map to the elevation ranges registered
  for the species at the International Union for Conservation of Nature (IUCN) to calculate the area of habitat for a species.
  In case that no range map is available, a thresholded species distribution model can be provided instead.
author:
  - name: Maria Isabel Arce-Plata
    identifier: https://orcid.org/0000-0003-4024-9268
  - name: Guillaume Larocque
    identifier: https://orcid.org/0000-0002-5967-9156
license: CC BY
inputs:
  spat_res:
    label: output spatial resolution
    description: Spatial resolution (in meters) for the output of the analysis.
    type: int
    example: 1000
  srs:
    label: spatial reference system
    description: Reference system for the area of interest. It can be
      1) the Spatial Reference System Identifier (SRID), 2) the authority name (e.g. EPSG) with the SRID or
      3) the description of the spatial reference system details (e.g. [https://spatialreference.org/]).
      If just the SRID is given and the software can not find the reference system try options 2 or 3.
    type: text
    example: EPSG:3116
  study_area_opt:
    label: study area option
    description: Choose the source for the study area either if it should be at a country level and downloaded
      according to the 'country_code', at region level according to 'region' or a user defined polygon with the
      borders of the study area.
    type: options
    options:
      - "Country"
      - "Region in Country"
      - "User defined"
    example:
        "Region in Country"
  study_area:
    label: study area
    description: Path to the study area file, if "User defined" study area option was chosen.
      This file should be a polygon with a .gpkg extension or .shp (in this case do not foget to add the projection file to the folder)
    type: application/geopackage+sqlite3
  country_code:
    label: country
    description: >
      Name of the country for the analysis, if "Country" or "Region in Country" study area option were chosen.
      Check the available countries here: https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-details/
      or check the name with the option "Try it out" at "country_geojson" here:
      https://geoio.biodiversite-quebec.ca/docs#/default/country_geojson_country_geojson__get
      the "Response body" section should show the information for the country.
    type: text
    example: Colombia
  region:
    label: region
    description: >
      Name of the region for the analysis, if "Region in Country" study area option was chosen.
      Check the available regions by putting the Country name at the option "Try it out" at "state_list" here:
      https://geoio.biodiversite-quebec.ca/docs#/default/state_list_state_list_get
    type: text
    example: "Bolívar"
  buff_size:
    label: buffer around study area
    description: Size of the buffer around the study area. If it is not defined it will be estimated as half of the total width of the study area.
    type: int
    example: 0
  species:
    label: species
    description: Scientific name of the species.
    type: text[]
    example:
      [
        "Myrmecophaga tridactyla"
      ]
  range_map_type:
    label: range map type
    description: >
      Select type of range map according to the type of the source file:
      1) polygon, 2) raster, 3) an intersection between the raster and polygon files.
    type: options
    options:
      - Polygon
      - Raster
      - Both
    example:
      Polygon
  sf_range_map:
    label: range map (polygon)
    description: One geopackage file with the polygon or polygons of the expected area for each species
      if "Polygon" or "Both" were chosen as range map type. If it is not available from scp_SHI_GetRangeMap.R
      then it is recommended to add a polygon with the limits of a species distribution model for the species.
    type: application/geopackage+sqlite3[]
    example:
      [
        "/scripts/data/getAreaOfHabitat_Saguinus oedipus range.gpkg"
      ]
  r_range_map:
    label: range map (raster)
    description: Binary raster with expected area for the species if "Raster" or "Both" were chosen as range map type.
    type: image/tiff;application=geotiff[]
    example:
      [
        null
      ]
  elevation_filter:
    label: filter by elevation
    description: If 'yes' an elevation filter using IUCN information is applied, if 'no' the range map is taken as the area of habitat.
    type: options
    options:
      - "Yes"
      - "No"
    example:
      "Yes"
  elev_buffer:
    label: elevation buffer
    description: Elevation buffer in meters to add (or substract) to the reported species elevation range. Default is zero.
      Positive values will increase the range by the given number and negative values will reduce the range.
    type: int
    example: 0
outputs:
  r_area_of_habitat:
    label: area of habitat
    description: Raster file with the area of habitat.
    type: image/tiff;application=geotiff[]
  sf_bbox:
    label: bounding box
    description: Bounding box for the area of habitat.
    type: application/geopackage+sqlite3[]
  df_aoh_areas:
    label: areas of reference sizes
    description: A TSV (Tab Separated Values) file containing the area of the range map loaded,
      the size of the study area, the area of the bounding box for the analysis,
      size of the buffer used to create the bounding box for the analysis, the size of the area of habitat.
      The units are in meters square.
    type: text/tab-separated-values
references:
  - text: Brooks, T. M., Pimm, S. L., Akçakaya, H. R., Buchanan, G. M., Butchart, S. H. M., Foden, W., Hilton-Taylor, C., Hoffmann, M., Jenkins, C. N., Joppa, L., Li, B. V., Menon, V., Ocampo-Peñuela, N., & Rondinini, C. (2019). Measuring Terrestrial Area of Habitat (AOH) and Its Utility for the IUCN Red List. Trends in Ecology & Evolution, 34(11), 977–986.
    doi: https://doi.org/10.1016/j.tree.2019.06.009
  - text: Jetz et al., Species Habitat Index, accessed on 24/8/2022
    doi: https://mol.org/indicators/habitat/background
  - text: Jetz, W., McGowan, J., Rinnan, D. S., Possingham, H. P., Visconti, P., O’Donnell, B., & Londoño-Murcia, M. C. (2022). Include biodiversity representation indicators in area-based conservation targets. Nature Ecology & Evolution, 6(2), 123–126.
    doi: https://doi.org/10.1038/s41559-021-01620-y
  - text: Soto L. & Roncancio N. 2017. Modelo de distribución de Saguinus oedipus ID PRI-629. Instituto Alexander von Humboldt.
    doi: http://biomodelos.humboldt.org.co/species/visor?species_id=7017
